from datetime import datetime, timedelta

# 기준일 (1936년 2월 12일, 갑자일)
REFERENCE_DATE = datetime(1936, 2, 12)

# 천간과 지지 배열 정의
HEAVENLY_STEMS = ["갑", "을", "병", "정", "무", "기", "경", "신", "임", "계"]
EARTHLY_BRANCHES = ["자", "축", "인", "묘", "진", "사", "오", "미", "신", "유", "술", "해"]

# 천간과 지지의 오행 정의
ELEMENTS = {
    "갑": "목", "을": "목",
    "병": "화", "정": "화",
    "무": "토", "기": "토",
    "경": "금", "신": "금",
    "임": "수", "계": "수",
    "자": "수", "축": "토",
    "인": "목", "묘": "목",
    "진": "토", "사": "화",
    "오": "화", "미": "토",
    "신": "금", "유": "금",
    "술": "토", "해": "수"
}

# 십성 정의 (기준은 일간)
TEN_GODS = {
    "비견": ["목", "목"],
    "겁재": ["목", "목"],
    "식신": ["목", "화"],
    "상관": ["목", "화"],
    "편재": ["목", "토"],
    "정재": ["목", "토"],
    "편관": ["목", "금"],
    "정관": ["목", "금"],
    "편인": ["목", "수"],
    "정인": ["목", "수"]
}

# 12운성 정의
TWELVE_STATES = {
    "장생": "생명 시작",
    "목욕": "성장과 변화",
    "관대": "성숙과 안정",
    "건록": "정점과 권위",
    "제왕": "최고의 권위",
    "쇠": "쇠퇴의 시작",
    "병": "병약과 약화",
    "사": "죽음과 소멸",
    "묘": "무덤, 잠복",
    "절": "새로운 시작",
    "태": "생명의 씨앗",
    "양": "에너지 축적"
}

# 천간-천간 십성 관계
TEN_GODS_STEM = {
    "갑": ["비견", "겁재", "식신", "상관", "편재", "정재", "편관", "정관", "편인", "정인"],
    "을": ["겁재", "비견", "상관", "식신", "정재", "편재", "정관", "편관", "정인", "편인"],
    "병": ["편인", "정인", "비견", "겁재", "식신", "상관", "편재", "정재", "편관", "정관"],
    "정": ["정인", "편인", "겁재", "비견", "상관", "식신", "정재", "편재", "정관", "편관"],
    "무": ["편관", "정관", "편인", "정인", "비견", "겁재", "식신", "상관", "편재", "정재"],
    "기": ["정관", "편관", "정인", "편인", "겁재", "비견", "상관", "식신", "정재", "편재"],
    "경": ["편재", "정재", "편관", "정관", "편인", "정인", "비견", "겁재", "식신", "상관"],
    "신": ["정재", "편재", "정관", "편관", "정인", "편인", "겁재", "비견", "상관", "식신"],
    "임": ["식신", "상관", "편재", "정재", "편관", "정관", "편인", "정인", "비견", "겁재"],
    "계": ["상관", "식신", "정재", "편재", "정관", "편관", "정인", "편인", "겁재", "비견"]
}

# 일간-지지 십성 관계 정의
TEN_GODS_BRANCH = {
    "갑": ["정인", "정재", "비견", "겁재", "편재", "식신", "상관", "정관", "편관", "편인", "정재", "편인"],
    "을": ["편인", "편재", "겁재", "비견", "정재", "상관", "식신", "편관", "정관", "정인", "편재", "정인"],
    "병": ["정관", "정재", "편인", "정인", "비견", "겁재", "식신", "상관", "편재", "편관", "정재", "편관"],
    "정": ["편관", "편재", "정인", "편인", "겁재", "비견", "상관", "식신", "정재", "정관", "편재", "정관"],
    "무": ["정재", "정재", "편관", "정관", "비견", "겁재", "식신", "상관", "편재", "정재", "편관", "정재"],
    "기": ["편재", "편재", "정관", "편관", "겁재", "비견", "상관", "식신", "정재", "편재", "정관", "편재"],
    "경": ["식신", "정재", "편재", "정재", "편인", "정인", "비견", "겁재", "식신", "상관", "정재", "상관"],
    "신": ["상관", "편재", "정재", "편재", "정인", "편인", "겁재", "비견", "상관", "식신", "편재", "식신"],
    "임": ["편재", "식신", "상관", "식신", "편관", "정관", "편인", "정인", "비견", "겁재", "식신", "겁재"],
    "계": ["식신", "상관", "편재", "상관", "정관", "편관", "정인", "편인", "겁재", "비견", "상관", "비견"]
}


# 십성 및 오행 계산 함수
def calculate_ten_god_and_element(day_stem, other_stem, branch):
    """
    십성과 오행 계산 함수.

    Parameters:
        day_stem (str): 일간
        other_stem (str): 비교할 천간
        branch (str): 지지

    Returns:
        dict: 오행과 십성 정보
    """
    # 오행 계산
    element_day = ELEMENTS.get(day_stem, "")
    element_other = ELEMENTS.get(other_stem, "")
    element_branch = ELEMENTS.get(branch, "")

    # 천간-천간 십성
    ten_god_stem = TEN_GODS_STEM.get(day_stem, [])[HEAVENLY_STEMS.index(other_stem)]

    # 천간-지지 십성
    ten_god_branch = TEN_GODS_BRANCH.get(day_stem, [])[EARTHLY_BRANCHES.index(branch)]

    return {
        "day_element": element_day,
        "other_element": element_other,
        "branch_element": element_branch,
        "ten_god_stem": ten_god_stem,
        "ten_god_branch": ten_god_branch
    }

# 테스트
if __name__ == "__main__":
    day_stem = "을"  # 예시 일간
    other_stem = "정"  # 예시 천간
    branch = "축"  # 예시 지지

    result = calculate_ten_god_and_element(day_stem, other_stem, branch)
    print("오행과 십성 계산 결과:")
    print(result)